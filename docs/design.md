阐述项目结构和各模块设计原理。
例如为什么要拆分模块，各模块职责是什么，如何扩展。本说明有助于读者理解项目的架构思想。
复杂的推导（比如光学原理、公式推导），可在文档提供推导过程或参考文献链接。
对于开源项目，这里也常包含贡献指南、许可协议等。
下面是一份 **“复杂环境下冲击波传播仿真与优化技术研究”——交互式 Python 仿真工具** 的完整需求说明（Software Requirements Specification / SRS）示例。你可以直接按此文档实施，也可在评审后按实际课题目标进行微调。

---

## 1. 目的与范围

1. **目标**
   构建一个基于光线追踪的交互式仿真工具，能够在无/有三维城市模型的条件下，快速预测爆炸冲击波在密集建筑群中的传播路径、到达时间、峰值超压等关键指标，并提供可视化与数据导出能力，辅助科研与工程评估。

2. **使用者**

    * 爆炸/防护工程研究人员
    * 城市安全规划与应急部门
    * 学术教学、演示与实验

3. **范围**

    * 支持 3D 城市场景导入（*.ply、*.obj、\*.stl）或程序化生成。
    * 支持单点爆心、单次爆炸的冲击波模拟（后期可扩展多源）。
    * 提供 GUI 交互：场景浏览、爆心与接收点设置、参数输入、结果查询。
    * 输出到达时间场、峰值超压场、典型路径可视化，以及 CSV / JSON 数据导出。

---

## 2. 功能性需求

### 2.1 场景管理

| 编号  | 描述                                | 重要度   |
| --- | --------------------------------- | ----- |
| F-1 | 程序化生成规则/随机建筑群（长方体体块，支持高度、密度、街宽参数） | **高** |
| F-2 | 导入/保存三维模型：PLY、OBJ、STL             | 高     |
| F-3 | 显示/隐藏单个建筑或建筑组                     | 中     |
| F-4 | 模型坐标系重定位与缩放（米制）                   | 中     |

### 2.2 爆炸源与接收点

| 编号  | 描述                                               | 重要度 |
| --- | ------------------------------------------------ | --- |
| F-5 | GUI 选择或数值输入爆心位置                                  | 高   |
| F-6 | 输入爆炸当量（TNT kg）→自动映射为初始峰值超压 P₀、能量 E₀              | 高   |
| F-7 | 可交互添加/删除接收点，实时查询到达时间 t\_arr、峰压 Ps、正相持续时间 td、冲量 I | 高   |
| F-8 | 支持矩形面阵列接收器（批量采样区域）                               | 中   |

### 2.3 冲击波传播模拟

| 编号   | 描述                                             | 重要度 |
| ---- | ---------------------------------------------- | --- |
| F-9  | 半球/球面均匀发射 N 条初级射线（用户可设 N 或精度等级）                | 高   |
| F-10 | 射线与场景首次相交：记录 L₁、法向，计算首达时间 t₁=L₁/ c             | 高   |
| F-11 | 多次镜面反射：支持 ≤ R\_max 次（默认 3），每次按材料吸收系数 α 衰减能量    | 高   |
| F-12 | 距离衰减：支持自由场指数或 Kingery-Bulmash 经验公式，P = f(L,E₀) | 高   |
| F-13 | 当射线强度 < P\_cut 或反射次数 > R\_max 时终止              | 高   |
| F-14 | 记录射线路径坐标序列与强度序列，用于后续可视化                        | 中   |
| F-15 | 可选简化：远场弱波允许忽略反射，自动降阶优化                         | 中   |

### 2.4 结果可视化与输出

| 编号   | 描述                                      | 重要度 |
| ---- | --------------------------------------- | --- |
| F-16 | 3D 视图渲染射线路径（彩色映射 t\_arr 或 Ps）           | 高   |
| F-17 | 热力图/点云显示地面或给定平面上 t\_arr、Ps、I 分布         | 高   |
| F-18 | 图例与颜色条支持自定义范围与配色                        | 中   |
| F-19 | 导出 CSV/JSON：每接收点 {x,y,z,t\_arr,Ps,I,td} | 高   |
| F-20 | 导出场景快照图像（PNG）和视频/帧序列（MP4、GIF）           | 中   |

### 2.5 交互与易用性

| 编号   | 描述                                   | 重要度 |
| ---- | ------------------------------------ | --- |
| F-21 | 带进度条的仿真任务队列；可中断、重跑                   | 高   |
| F-22 | 配置面板：射线数量 N、反射上限 R\_max、吸收系数 α、裁剪阈值等 | 高   |
| F-23 | 保存/加载完整工程（场景+参数+结果）                  | 中   |
| F-24 | 多语言界面（起步中文，可预留 i18n）                 | 低   |

---

## 3. 非功能性需求

| 分类  | 需求                                                                       |
| --- | ------------------------------------------------------------------------ |
| 性能  | 中型场景（50 栋、1 万面）+ 2 万射线 + 3 次反射在 5 秒内完成；大型场景（100 栋、10 万面）+ 5 万射线在 30 秒内完成 |
| 并行  | 默认启用 CPU 多线程；若检测到 GPU (Open3D SYCL) 可自动启用                                |
| 可扩展 | 模块化设计（environment、core、physics、ui、io、tests），后续可替换新物理模型                   |
| 可维护 | 80% 以上核心函数需有单元测试；关键算法含完整 docstring                                       |
| 兼容  | Python 3.12；Windows 10/11, Ubuntu 22.04；Open3D ≥ 0.19                    |
| 安全  | 加载外部模型时沙盒化路径、限制文件大小，防止注入                                                 |
| 文档  | 在线使用文档 + API 文档 (Sphinx)；示例工程与步骤教程                                       |

---

## 4. 外部接口

| 类型    | 接口                                   | 说明                  |
| ----- | ------------------------------------ | ------------------- |
| 图形 UI | Open3D -> `open3d.visualization.gui` | 主窗体、菜单栏、参数面板、进度弹窗   |
| 命令行   | `python -m shocksim <config.yml>`    | 支持无界面批处理            |
| 配置文件  | YAML / JSON                          | 统一参数描述，gui 与 cli 共用 |
| 数据导出  | CSV、JSON、PNG、MP4/GIF                 | 结果后处理与报告            |

---

## 5. 约束与假设

1. **几何声学近似**：忽略波前弯曲、粘性耗散等复杂效应，仅靠射线反射 + 距离衰减模拟阴影区声压衰减。
2. **建筑简化**：建筑物按刚性墙面处理；高精度弹性/多层结构留作后续版本。
3. **单爆源**：V1.0 只支持单次爆炸；多源/多时序留给 V2.0。
4. **用户硬件**：假设目标用户拥有 4 核及以上 CPU，≥ 16 GB RAM；GPU 加速为可选而不强依赖。

---

## 6. 数据与模型

| 数据项             | 描述                        | 来源         |
| --------------- | ------------------------- | ---------- |
| 建筑网格            | 三角形/四边形网格，单位米             | 程序化生成或用户导入 |
| 材料吸收系数 α        | \[0,1] 默认 0.2 (混凝土)       | 可查表或用户输入   |
| 爆炸当量 W (TNT kg) | 转换为初始峰压 P₀、冲量 I₀          | 标准公式       |
| 声速 c            | 343 m/s (20 °C)           | 常量         |
| K-B 表           | Kingery-Bulmash 自由场冲击波经验表 | 内置 CSV     |

---

## 7. 质量保证

* **单元测试**：pytest；覆盖率 > 80%。
* **CI/CD**：GitHub Actions -> lint, test, build wheel, publish文档。
* **基准测试**：分别对射线数量、三角面数、反射次数做性能剖面；自动生成性能曲线。
* **用户验收**：准备用例场景 + 期望数值窗口 ± 10%。

---

## 8. 版本规划（里程碑）

| 版本     | 主要功能                         | 计划时间 |
| ------ | ---------------------------- | ---- |
| 0.1 原型 | 程序化城市 + 单次直射 (无反射)，结果 CSV 输出 | 2 周  |
| 0.2    | 多次镜面反射、距离衰减、简易 GUI           | +2 周 |
| 0.3    | 吸收系数、射线终止阈值、CLI 批量模式         | +1 周 |
| 0.4    | 完整 GUI、可视化、工程保存/加载           | +3 周 |
| 1.0    | 性能优化、文档、测试完善                 | +2 周 |

（合计约 10 周，可根据实际进度调整）

---

## 9. 风险与应对

---

### 附录 A — 术语表

* **射线 (Ray)**：在几何声学中代表能量束中心线，忽略波面扩散。
* **峰压 Ps**：爆炸冲击波的峰值超压。
* **正相持续时间 td**：从波头到超压首次降至 0 的时间。
* **冲量 I**：超压‐时间曲线正向积分。
* **BVH**：Bounding Volume Hierarchy，射线跟踪中的递归包围盒加速结构。

---

> **使用方法**
>
> 1. 评审以上需求，标记“必需 / 可选 / 后续”。
> 2. 如需迭代，建议在每版只引入有限个新特性，保持可测试性。
> 3. 将本需求文档放入仓库的 `docs/`，与代码、测试一起持续维护。
